# 2020年11月

# 2020/11/02

* 高等动力学

    复习哈密顿正则方程
    
    完成作业

* 航天动力学

    编写答案
    
    批改作业

* 主带小行星轨道根数分布范围分析
    
    用python程序对原始数据进行处理。

    用Matlab对主带小行星轨道根数的范围进行大致分析。

    由6个轨道根数地直方图分布可以看出，半长轴a的范围为[2.0,3.0]，偏心率e的范围为[0,0.4]，轨道倾角i的范围为[0,20]度。其余三个轨道根数在0-360度的区间内分布较为均匀，没有明显规律。
    
    测试随机产生初、末轨道根数和初始质量，重复求解10次时间最优问题，生成一条数据。
    
    后续工作：
    
    **在上述轨道根数的范围内，随机建立虚拟天体，计算最优转移时间，分析转移时间较短的情况有什么共同特点？这个特点应该怎样描述？**
    
    每一次转移对应13个影响因素，初、末轨道根数和初始质量。从这13个因素中每次拿出两个/三个，分析它们和最优指标之间的关系。

## 2020/11/03

* LTGA

    * 间接法求解引力辅助问题，将整个问题分为五个过程：时间最优飞越问题、燃料最优飞越问题、引力辅助、时间最优交会问题、燃料最优交会问题。
    
    * 添加重复求解时间最优问题的功能，重复次数为10次、20次结果相同，后续都采用重复计算10次。
    
    * 结果：比例系数为0.3-0.5，每隔0.1进行一次计算，当比例系数为0.35时，剩余质量最大，为 15822.030198 kg。
    
    * 结果：在比例系数为0.34-0.36的范围内，以0.001为间隔，进行更详细的搜索，比例系数为0.347时，剩余质量最大，为 15839.872773 kg。
    
    * 将factor作为目标函数的参数，使用PSO搜索算法计算最优解。为了加快计算速度，暂时取消时间最优重复计算，每个时间最优问题只求解一次。（计算中）

* Data1

    按照主带小行星轨道根数分布范围的分析结果，随机产生两组轨道根数，作为虚拟天体，使用间接法求解时间最优交会问题，生成数据集。（计算中）
    
    这样相比之前真实天体的做法优势在于，当数据集数量足够大时，可以保证轨道根数空间的均匀覆盖。
    
    在生成数据集的过程中，先对之前的数据集进行分析，分析转移时间较短的情况有什么特点？

## 2020/11/04

* 最优转移时间数据集分析

    对之前的数据集进行分析。

    100000个数据点中，大部分数据的转移时间集中在500天附近的区间内，转移时间小于200天的仅有534个，且绝大多数位于150-200天之间。

    试图找出对转移时间小于200天的数据点的特点。

    由于在生成数据集的时候，已经对于初末轨道的轨道根数之差做了限制，囊括的范围比较小。

    但仍然可以从直方图可以看出，初、末轨道根数之差较小的所占比例很大。

* 阅读文献 Automated mission planning via evolutionary algorithms

    和之前的一篇论文 Automated solution of the low-thrust interplanetary trajectory problem 相同，考虑脉冲多次引力辅助问题，添加了深空机动，主要思想仍然是将轨迹优化问题分为两层循环。
    
    外层循环通过遗传算法搜索引力辅助序列。
    
    内层循环采用PSO和DE搜索最佳引力辅助时刻和深空机动相关参数。

## 2020/11/05

* 组会

    武迪师兄意见：引力辅助处的策略有问题，需要增加决策变量

* LTGA

    由于PSO搜索程序是寻找目标函数的最小值，而我们要求的是剩余质量最大，因此目标函数的返回值应该是剩余质量的相反数。
    
    对于无法完成燃料最优交会的情况，返回值设置为一个很大的数1e7。

* 学习C++并行

    可以用于PSO，同时计算不同粒子的目标函数值。
    
    但是for循环需要一些限制从而能在执行C++ for之前确定循环次数，因此不能用于打靶中。

* 回顾文献 Fast preliminary design of low-thrust trajectories for multi-asteroid exploration

## 2020/11/09

* 航天动力学

    批改作业：常数变易法求解二阶微分方程。

* 思考高等动力学大作业题目

## 2020/11/10

* 高等动力学

	作业：哈密顿变分原理-里兹法

	思考大作业题目，没有结果，内心极其痛苦，晚些时候再想。

* 整理文献管理软件

## 2020/11/11

* 阅读文献 Automated multigravity assist trajectory planning with a modified ant colony algorithm

* LTGA

	PSO搜索结果：比例系数为0.346872586479787，剩余质量为15839.8971406158kg。相较于比例系数为0.347的结果，PSO算法的提升较小。

* 多目标探测

	由于之前的数据集初始质量的范围是1000-2000kg，考虑较短序列转移问题。

	在剔除掉偏心率大于0.1的小行星之后的小行星中，选取前50颗，进行一个小规模的数值实验：

	在某一固定时刻，从任意一颗小行星出发，与另外一颗小行星交会，使得转移时间最短。

	只用来估计一段转移时间，然后选取时间最短的一个，预测结果与间接法计算结果进行比较，相对误差为-9%。

* 神经网络训练

	对于训练集中相对误差超过50%的数据进行分析，共18条。发现这些数据的转移时间都比较短，正是我们最需要的那部分数据，但是误差却很大，而且全部都是预测值大于真实值。因此，数据集没有问题，是**神经网络的训练效果不好**。

	然后观察训练集中真实转移时间小于3的数据，发现并不是所有转移时间较小的数据的预测误差都很大，也有很多误差小于百分之一的。

	下一步的想法：

	1. 改进神经网络

	2. 增加转移时间较短的数据。

## 2020/11/16

* 阅读文献 Genetic algorithms applied to the solution of hybrid optimal control problems in astrodynamics

* 高等动力学大作业题目

	题目：双足机器人动力学与步态稳定性分析

	大致内容：将双足机器人简化为连杆机构，推导运动学和动力学方程，并在给定的步态条件下，计算各个关节所需要的驱动力矩，最后分析双足机器人能够稳定步行的条件。

* 航天动力学第八次作业

	调试程序。

	查找谢芳霖、胡宇强程序中的bug。

## 2020/11/17

* 航天动力学

	批改作业。

	为了防止误判，查找每个同学程序中的错误原因。

* LTGA

	修改引力辅助模型，采用最小引力辅助半径，计算vin和vout的夹角，仍然只考虑在平面内进行引力辅助，将引力辅助时间作为唯一的优化变量。

	令`factor=0.347`，剩余质量为15822.684kg，小于之前模型下的剩余质量。

	检查之前的引力辅助模型下的引力辅助半径，发现确实小于允许的最小引力辅助半径。

## 2020/11/18

* LTGA

	在修正后的平面引力辅助模型下，设置比例系数为0.25-0.45，以0.01为间隔，计算剩余质量。

	当比例系数在0.30-0.35的范围时，可以完成转移，`factor=0.34`时，剩余质量最大，为15821.786kg。

	设置比例系数为0.33-0.35，以0.001为间隔，计算剩余质量，`factor=0.344`时，剩余质量最大，为15839.980kg，略大于错误模型的最大剩余质量。

	> 采用错误模型时，比例系数为0.347时，剩余质量最大，为15839.873kg。

	将引力辅助时间、引力辅助半径、`vout`的方向角作为3个优化变量，设置三个优化变量的范围与间隔，计算剩余质量。

	并行可能会导致输出结果混乱，因此不采用并行。

* 阅读文献

	Exploration of Alternative State Vector Choices for Low-Thrust Trajectory Optimization

	Hidden genes genetic algorithm for multi-gravity-assist trajectories optimization

## 2020/11/19

* 讲座

	AGI 人工通用智能

	科研要形成闭环，摸着石头过河，做的过程中会发现很多之前注意不到的问题、困惑。

* 阅读文献

	Very low-thrust trajectory optimization using a direct SQP method

	Shape-based approach to low-thrust rendezvous trajectory design

* LTGA

	针对上一步的计算结果，重新规划三个变量的范围分别为0.3-0.35，0.0-1.0，0.0-0.5，使用PSO搜索。

	程序运行时会在一个地方卡住，偏差与步长趋于无穷，为了方便查找问题来源，不采用并行。

## 2020/11/20

* 思考

	* 神经网络预测最优转移时间+集束搜索，最短时间访问5颗小行星，保留最好的20条序列，然后对每一条序列采用两种方法进行优化：

		1. 计算每一段的最短转移时间

		2. 进行整体优化

	* LTGA，把第一段轨迹的末端速度也当作优化变量，现在共有6个优化变量（引力辅助时间、引力辅助半径、引力辅助旋转角、第一段轨迹末端速度的3个方向的分量），分别求解两段燃料最优交会问题，应该可以得到最优解。

	* shape-based方法

		1. 参数的计算方法？(1)根据边界条件可以全部确定（无法考虑推力幅值约束）；(2)将全部/部分参数作为参数，求解NLP问题（这种方法可以考虑推力幅值约束）；

		2. 如何处理三维问题？

		3. 如何处理推力幅值约束？

		4. 应用于多目标探测问题！！可以直接用于多目标交会问题，如果每一段轨迹用4次5个变量的逆多项式形函数描述，可以用于多目标飞越问题（GTOC4）

* 阅读文献

	Shape-based algorithm for automated design of low-thrust, gravity-assist trajectories

	Method部分没有读完，看不下去了。

## 2020/11/23

* LTGA

	三变量PSO搜索运行结果，提升幅度不大。

	学习使用NPSOL。

	用PSO的目标函数作为NPSOL的目标函数，三个变量的上下限均为0和1，没有线性/非线性约束。

	用NPSOL对PSO的结果进行优化，一直报错，错误位置是ODE45，下午一直在调试，没有找到原因。

	将程序清空，然后一点点加上去，逐步测试，直到全部复原，程序可以正常运行。

	与报错的文件对比，差别仅是头文件的顺序不同。

	再次使用报错的文件进行测试，原因确实是`localConst.h`的位置导致的，放在最后会导致报错，**头文件的顺序会导致报错**，但不知道为什么？

	初值的第二项为0.01或更小时，会被直接忽略，变成0，不了解NPSOL的工作原理，不知道为什么？以0.8、0.1、0.45作为初值进行计算。

	`x`会采用同一组数据进行多次计算，不知道为什么？

	目标函数梯度不正确，`XXX  The objective gradients seem to be incorrect.`

	NPSOL具体如何通过有限差分计算导数，好像在使用不同步长多次计算，初始步长好像挺小的。

* 多目标转移

	保留多条转移序列，先用小规模算例测试程序正确性，然后运行大规模程序。（运行中）

	自定义类中有vector嵌套时，析构函数需要从内到外依次释放空间。

## 2020/11/24

* 航天动力学

	批改作业

	摄动加速度大小的变化量、摄动加速度变化量的大小

	大作业中关于太阳光压力的处理方式，如何判断是否进入地影区。

## 2020/11/25

* LTGA

	调用NPSOL，提示梯度计算不正确，查找问题原因。

	根据说明文档，应该是人为提供的目标函数的梯度，NPSOL验证失败。

	查找到程序中的`npsolfnobj`和`npsolfncon`函数，发现里面对目标函数和非线性约束的导数进行了计算，但是计算是针对测试的简单算例，因此需要修改。

	直接去掉。

	调试NPSOL，发现程序只会在初始值附近的极小范围内进行计算，无法起到优化效果。

## 2020/11/26

* 继续调试NPSOL，失败

* 用离散点进行计算（进行中），观察是否存在局部最优解

* 学习使用NLOPT

	无梯度优化算法：COBYLA、BOBYQA

	无论是将PSO优化结果作为初值，还是随机选取初值，NLOPT的效果都比NPSOL要好。

* 回顾文献

	Fast evaluation of low-thrust transfers via multilayer perceptions

## 2020/11/27

* LTGA

	将第一段轨迹末端相对于火星的相对速度的三个分量作为优化变量，求解两段燃料最优交会问题。

	用NLOPT对6变量的目标函数进行优化，初值为三变量的NLOPT优化结果。

	由于NLOPT进行的是局部优化，很可能是局部最优解，应该事先用PSO进行全局优化，再用PSO的结果作为初值进行局部优化。（PSO进行中）

* 回顾文献

	Fast evaluation of low-thrust transfers via multilayer perceptions

	本文用分类模型判断转移是否可行，是一个很好的思路。
	
	能否通过判断最优转移时间和当前所给转移时间的大小，来判断转移是否可行？如果当前所给的转移时间大于最优转移时间，那么转移是否一定能实现？

## 2020/11/30

* LTGA

	第一次燃料最优交会问题求解困难，为了解决这一问题，提出两种解决方案：

	1. 用春分点轨道根数代替直角坐标进行求解

    	仍然很难收敛。

	2. 加入同伦过程

	    春分点轨道根数表示，同伦参数为1.0，很难收敛。

	    直角坐标表示，同伦参数为1.0或0.1，非常容易收敛。

	    同伦过程不容易控制，没有一个统一的方法使得同伦过程的每一步都收敛。

	    同伦过程由于数值精度的原因，每次运行结果不同，很不稳定。

	最终决定，对这部分不进行改进，设置最大随机猜测次数为1000。

* C++编程

	全局变量的定义与声明：全局变量应该在头文件中声明，在一个源文件中进行定义。

	将PSO程序改写为并行模式，在服务器中计算。

	PSO种群数量可以大于线程数量，在上一个线程运行结束之后，运行后面“排队等待”的个体。

	尝试使用并行生成小推力时间最优转移数据集，发现每个线程产生的随机数是相同的，因为随机数种子是根据当前时间设置的，所有线程同时开始，随机数种子相同，产生的随机数相同。

	为解决这一问题，采用精度更高的时间表示方法设置随机数种子。

	但是，并行生成数据集的速度并没有加快。