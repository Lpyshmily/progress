# 2020年5月

## 2020/05/11

对当前需要完成的任务以及接下来要做的事情做一下总结。

1. 下一阶段的主要任务是熟练运用间接法进行局部优化。
   * 采用直角坐标的表示方法，对《深空探测动力学与控制》第五章中的两个算例进行复现。
   * 深入理解中途飞越、交会、引力辅助等约束条件，明确不同约束条件下打靶变量和打靶条件都是什么。

2. 课程作业
   * 《运动稳定性》大作业：对于范德玻尔方程的背景、稳定性分析、极限环分析、数值计算。
   * 《深空探测轨道力学》：与目前的研究相结合，对于GTOC4序列搜索的结果进行局部优化。

## 2020/05/12

- [x] 讨论班——王兆伟

- [x] 准备运动稳定性大作业

  通过看非线性振动这门课的一些PPT和作业，回顾了非线性振动系统的处理方法、范德波尔方程的具体形式、极限环的计算。对于大作业具体要做的内容做了一个大概的规划：范德波尔方程概述、平衡点和稳定性、极限环、数值仿真验证。
  极限环这个概念与课上所学的稳定性不同。很显然，具有稳定极限环的系统是不稳定的，如果选取的ε比较小，那么一定不满足李雅普诺夫条件。但是极限环在某种意义上，也是一种“稳定”。

  * 极限环分为稳定极限环、不稳定极限环、半稳定极限环，如何进行判断？
  * 本科非线性振动课上计算的极限环都是针对一些比较特殊的系统，通过简单的积分就可以得到极限环，但是对于范德波尔方程或者其他更一般的系统，有没有统一的计算极限环的方法？换一种说法，如何求微分方程的周期解？
  * 如何判断一个系统是否存在极限环，也就是极限环的存在性问题。

- [x] 上课——运动稳定性

- [x] 学习间接法局部优化

  采用春分点轨道根数计算《深空探测动力学与控制》第五章的第一个算例：从地球到进行的交会问题。同伦参数设置为1×10-5，随机猜测协态初值，最大猜测次数为100。采用春分点轨道根数求解时需要特殊考虑最后一个轨道根数，本算例中转移时间为1000天，分别设置转移圈数为0~6，计算结果如下：

  | 圈数 | 剩余质量/kg | 书中的剩余质量/kg |
  | ---- | ----------- | ----------------- |
  | 0    |             |                   |
  | 1    |             |                   |
  | 2    | 1036.269    | 1036.332          |
  | 3    | 1290.565    | 1290.578          |
  | 4    | 1259.734    | 1259.696          |
  | 5    | 1006.623    | 1006.557          |
  | 6    |             |                   |


  重复运行两次程序，计算结果相同。圈数为3圈和4圈时，计算的剩余质量比书中的略多。

## 2020/05/13

- [x] 组会
- [x] 学习间接法局部优化
  * 输出积分过程中积分变量的值，通过MATLAB读取，将春分点轨道根数转化为位置和速度，并进行可视化
  * 对直角坐标进行多次计算，收敛速度慢，而且由于无法像春分点轨道根数那样指定转移圈数，会收敛到一些局部最优解，如4圈或5圈的结果

下一步计划：

* 学习输出控制变量u
* 学习编程实现真正的燃料最优，将同伦参数降至0

## 2020/05/14

* 离散积分输出推力大小$u$随时间的变化
  * 进行间接法局部优化，得到收敛解的协态初值
  * 人为指定输出$u$的时间节点
  * 利用初始状态变量和收敛解的协态初值，分别积分至每一个时间节点，获得那一时刻的推力大小$u$，输出到文件中。
* 阅读文献 Trajectory Optimization of Multi-Asteroids Exploration with Low Thrust
  * 出版时间：2009
  * 期刊名称：
  * 作者：Kaijian ZHU, Fanghua JIANG, Junfeng LI and Hexi BAOYIN 
  * 主要内容：清华大学GTOC3（从地球出发交会散客小行星，然后返回地球，允许地球引力辅助）求解方案
    1. 采用春分点轨道根数进行计算
    2. 进行优化之前，先剔除轨道倾角和偏心率较大的小行星，仅剩下16颗小行星
    3. 在选择序列时，基于轨道根数估计转移所需的能量。估计速度增量时，先当作共面轨道转移，直接应用霍曼转移，在第二段速度增量处考虑轨道倾角$i$和升交点赤经$\Omega$，保留速度增量之和最小的30个序列
    4. 在确定序列之后，使用直接法进行优化，将PSO和DE与相结合，前30次迭代用PSO，后20次迭代用DE
    5. synodic-period 
  * 启示：
    1. 观察、总结GTOC4优胜者探测序列中的小行星的特点

## 2020/05/16

* 离散积分输出推力大小$u$随时间的变化

  之前设置离散输出2000个时间节点的推力大小，程序运行1天，没有得到结果，检查程序存在两处bug：

  1. 嵌套循环中使用了重复的循环变量
  2. 每次积分之后，14个积分变量没有恢复到初始状态

  设置时间节点个数分别为100和1000，两者推理随时间变化曲线基本相同，1000点已经比较充足。

* 去掉同伦参数，根据开关函数正负判断推力大小为0或1。仍采用随机猜测100次，第2次的时候收敛，剩余质量为1290.573kg，观察bang-bang控制推力随时间变化曲线，与书中图5.2相符

* 作图，在平面轨迹图中，用不同颜色区分有无推力

## 2020/05/18

* 引力辅助编程
  * 与迟师姐确认了书中的一个数据错误
  * 求解两个lambert问题计算脉冲引力辅助所需的速度增量。在引力辅助前后/公共近星点施加脉冲，哪种更好，有没有一致的结论？
  * PSO搜索脉冲引力辅助最优的引力辅助时刻。采用引力辅助后开启发动机，总的速度增量为18.9982 km/s
  * 在公共近星点开启发动机是否会更好？引力辅助前开启发动机怎么样？21.9026 km/s
  * 学习了在公共近星点开启发动机最优引力辅助，但程序中没有得到收敛解。

## 2020/05/19

* 准备运动稳定性大作业

  对范德波尔方程平衡点的稳定性进行了详细分析，在$\mu$取不同值时，平衡点的类型有三种可能：不稳定焦点、不稳定结点、不稳定一轴结点。

  采用迭代法计算范德波尔方程的极限环，即寻找后继函数的不动点。迭代过程比计算Halo轨道简单很多。

  学习用Poincaré环域定理判断范德波尔方程极限环的存在，通过构造一个环形边界，边界上所有点的轨线方向都指向环形区域内部。

  学习了三种判别闭轨线不存在的法则。

  学习了一种判断极限环稳定性的简单算法，可以用来判断带发条的钟摆极限环的稳定性。

  后续会继续学习极限环存在性和唯一性的判别，并用数值算例仿真验证。

* 上课——运动稳定性

* 编程——间接法求解引力辅助交会问题

  目前已经完成了导数的计算，打靶方程偏差的计算，还没有进行打靶方程的求解。

## 2020/05/20

* 组会之后，结合蒋老师的建议，规划下一阶段的工作
  * bang-bang控制程序中，应采用定步长积分，进行开关函数检测。
  * 间接法求解时，直接使用较小的同伦参数可能不好收敛，还是应该先从能量最优进行求解，然后逐步同伦到一个很小的同伦参数或者bang-bang控制
  * 间接法求解时，如果采用直角坐标，积分过程中，状态量的改变比较剧烈，最好采用轨道根数/春分点轨道根数，在设计引力辅助或者复杂约束时，也应该将约束条件和协态方程用轨道根数来表示。

## 2020/05/22

* 阅读文献 A review of optimization techniques in spacecraft flight trajectory design  

  * 出版时间：2019

  * 期刊名称：Progress in Aerospace Sciences

  * 作者：Runqi Chai, Al Savvaris, Antonios Tsourdos, Senchun Chai, Yuanqing Xia

  * 主要内容：综述文章的写法非常值得借鉴！

    第二章：建立数学模型：动力学方程、边界约束、路径约束、目标函数，并选用直接法作为优化策略。

    第三章：求解非线性规划的方法，the gradient-based, convexification-based, dynamic programming-based, and derivative-free (heuristic-based) optimization。

    * 3.1 the gradient-based: SQP-the active set strategy、IP-the penalty functions 、IPSQP
    * 3.2 Evolutionary-based methods: GA、DE、PSO、PIO、ACO、ABC。最优性不能得到保证。
    * 3.3 Convexification-based methods : LP、SOCP、SDP
    * 3.4 Dynamic programming-based methods: DP、DDP

    第四章：多目标轨迹优化，the multi-objective evolutionary algorithm-based techniques，the multi-objective transcription method-based strategy-对目标函数的重要性进行排序

    第五章：随机轨迹优化：随机+扰动

    * 5.1 动力学方程确定，路径约束可变，robust
    * 5.2 动力学发生改变

    第六章：优化算法的应用

    * 6.1 guidance和control相结合
    * 6.2 卫星编队控制律
    * 6.3 Database-based online guidance strategy 

  * 总结

    1. 轨迹优化的两个研究方向：一个是可靠性/适应性，如何更好地描述动力学系统；另一个是最优性，如何使结果更优。
    2. 将直接法和间接法的不同概括为**离散化**和**最优化**的顺序不同。间接法的缺点在于不好处理不等式约束
    3. 同一算法应用于不同问题时的表现可能差别很大

* 引力辅助编程

  完成了直角坐标间接法求解引力辅助问题的整个程序。

  调试过程中发现了一个错误：引力辅助后速度的三个分量没有改变。

  目前无法得到收敛解，下一步考虑改变初始值的猜测方式。

## 2020/05/25

* 阅读文献 Machine Learning and Evolutionary Techniques in Interplanetary Trajectory Design

  * 出版时间：2019
  * 期刊名称：Modeling and Optimization in Space Engineering, Springer Optimization and Its Applications
  
  * 作者：Dario Izzo, Christopher Iliffe Sprague, and Dharmesh Vijay Tailor
  
  * 主要内容：总结现有的轨迹优化方法，在机器学习用于着陆控制的基础上，将机器学习用于轨迹优化
  
    第二章：进化算法，多目标，涉及整数变量时结合树搜索进行两次单独的优化
  
    第三章：机器学习，用进化算法过程产生的数据集进行训练，快速计算最优解；无监督学习，如KNN，用于剔除一部分解。生成在线实时指导策略，从着陆问题拓展到星际航行
    
    第四章：最优控制，二次同伦，当末端约束不是交会时，有一个轨道根数自由，没有转换坐标系，而是转换了横截条件，没弄明白怎么推导的。
    
    第六章：最优轨迹上的状态变量和协态变量附近进行随机摄动，生成数据集。只能用于某个特定任务，不具有一般性。
    
    第八章：结果分析，切换点附近的控制律很难预测

## 2020/05/26

* 讨论班——冯若愚
* 运动稳定性大作业
  1. 极限环：孤立的闭轨线。外/内稳定极限环、外/内不稳定极限环、稳定极限环、不稳定极限环、半稳定极限环
  2. 切性曲线：$F(x,y)$的斜率和相曲线的切点连线起来
  3. 判定准则：Poincare切性曲线法、Dulac判定法、Bendixson判定法。Bendixson判定法可以看作是Dulac判定法的特例。可以证明：**线性系统不存在极限环**。
  4. 稳定性：Konigs定理
  5. 3个例子

## 2020/05/27 周三

* 阅读文献 Direct and indirect methods for trajectory optimization

  * 出版时间：1992

  * 期刊名称：Annals of Operations Research

  * 作者：O. yon STRYK and R. BULIRSCH

  * 主要内容：总结直接法和间接法的优缺点，提出了一种混合法，直接法得到的

    直接法与间接法相比，对于状态变量的近似较为准确，对于控制变量误差较大。
  
    第二章：介绍了间接法和直接法的求解思路和优缺点
  
    第三章：介绍了一种直接法，在每一个时间区间内，状态变量采用三次Hermite插值，节点处自动满足状态方程
  
    第四章：直接法（非线性规划）KKT条件，等距网格，状态方程泰勒展开。
    
  * 直接法中的拉格朗日乘子等价为间接法中的协态变量，可以作为猜测初值，但是直接法求解时是否需要计算拉格朗日乘子？还需要对直接法有更加深入的了解。

## 2020/05/28 周四

* 上课——航天器轨道动力学与控制

* 阅读文献 Trajectory optimization for low-thrust multiple asteroids rendezvous mission

  * 出版时间：2016

  * 期刊名称：Advances in the Astronautical Sciences

  * 作者：Gao Tang, Fanghua Jiang, and Junfeng Li

  * 主要内容：求解多目标交会问题，间接法，结合同伦方法和开关函数检测.

    单独计算每个单段交会问题，计算结果作为初值进行整体优化。

    第二部分：介绍单段交会轨迹优化。采用春分点轨道根数。不同同伦形式（指数同伦、二次同伦）的比较。初值猜测的方法（协态归一化）。**定步长积分、自适应步长积分。长时间停泊（无推力）可采用解析解。计算Jacobi矩阵的方法。小偏心率小倾角情况下的转移，可以简化计算协态变量。初始猜测协态变量后先进行归一化，再进行迭代。**

    第三部分：开关函数检测，用于二次同伦和bang-bang控制

    第四部分：多目标交会问题，打靶变量和打靶方程，用单段求解的协态变量作为初值，需要进行调整，以满足质量协态的连续，从后往前逐段进行改

* 阅读文献 Direct trajectory optimization using nonlinear programming and collocation

  * 出版时间：1987
  
  * 期刊名称：JGCD

  * 作者：C.R. Margraves and S.W. Paris

  * 主要内容：

    将每一个小区间中点处满足状态方程，作为约束条件

    为了使非线性规划的结果更加准确，可以改进的地方有以下几个方面：problem scaling, partial derivative computation, data smoothing, node selection, and node refinement. 
  
    采用NPDOT求解器